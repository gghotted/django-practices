<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
</head>
<body>
<div>
    <table id="room_infos">
    {% for room in object_list %}
        <tr>
            <td>{{room.id}}</td>
            <td id="participant_{{room.id}}">{{room.participant_num}}</td>
        </tr>
    {% endfor %}
    </table>
</div>
</body>
<script>
    var chatSocket = new WebSocket(
        `ws://${window.location.host}/ws/chat/lobby/`
    );
    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];
        for (i = 0; i < message.length; i++) {
            var room = message[i];
            var paCell = document.querySelector('#participant_' + String(room.id));
            if (!paCell) {
                const table = document.querySelector('#room_infos');
                const newRow = table.insertRow();
                const idCell = newRow.insertCell(0);
                idCell.innerText = room.id;
                paCell = newRow.insertCell(1);
                paCell.id = 'participant_' + String(room.id);
            }
            paCell.innerText = room.participant_num;
        }
    }
</script>
</html>